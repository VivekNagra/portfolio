<!doctype html>
<html lang="da">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nordlys</title>
    <meta name="robots" content="noindex,nofollow" />
    <style>
      :root { --brand: #ec4899; /* pink-500 */ --brand2: #f472b6; }
      body {
        margin: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        background: radial-gradient(900px 500px at 80% -10%, rgba(236,72,153,0.22), transparent), radial-gradient(700px 400px at 10% 10%, rgba(244,114,182,0.18), transparent), #0b0b0b;
        color: #e5e7eb;
      }
      .wrap { max-width: 720px; margin: 24px auto; padding: 0 16px; }
      .card {
        background: linear-gradient(180deg, rgba(17,18,20,0.9), rgba(17,18,20,0.95));
        border: 1px solid rgba(244,114,182,0.22);
        border-radius: 16px;
        padding: 18px;
        box-shadow: 0 18px 50px -24px rgba(236,72,153,0.35);
      }
      h1 { margin: 0 0 10px; font-size: 26px; }
      p { color: #cbd5e1; }
      .field { margin-top: 12px; }
      input[type="password"] { width: 100%; padding: 10px 12px; background:#0b0b0b; color:#e5e7eb; border:1px solid #3f3f46; border-radius:8px; }
      button {
        margin-top: 12px; width: 100%; padding: 10px 12px; border-radius: 10px; font-weight: 700; color: white;
        background: linear-gradient(90deg, var(--brand), var(--brand2), var(--brand));
        background-size: 200% 100%; border: 0; cursor: pointer; box-shadow: 0 10px 30px -12px rgba(236,72,153,0.5);
      }
      button:disabled { opacity: .6; cursor: not-allowed; }
      .error { margin-top: 10px; color: #fecaca; }
      .content { white-space: pre-wrap; }
      .actions { margin-top: 12px; text-align: right; }
      .link { color: #f9a8d4; }
      .hero { text-align: center; padding: 12px 8px 6px; }
      .hero h2 { font-size: 24px; margin: 0 0 6px; letter-spacing: 0.2px; }
      .hero p { margin: 0; color: #f5d0e6; }
      .heart { display:inline-block; margin-left: 6px; color: #f472b6; filter: drop-shadow(0 4px 12px rgba(236,72,153,0.35)); }
      .since { margin-top: 12px; text-align:center; color:#ffd0e5; }
      .since .row { display:inline-flex; gap:12px; padding: 12px 14px; border-radius: 18px; border: 1px solid rgba(255,192,203,0.25); box-shadow: 0 15px 28px -18px rgba(236,72,153,0.5); background: rgba(236,72,153,0.08); }
      .since .chip { min-width:70px; padding:10px 0; border-radius:14px; background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,192,203,0.05)); border: 1px solid rgba(255,255,255,0.12); box-shadow: inset 0 1px 0 rgba(255,255,255,0.25); }
      .since .num { display:block; font-size: 24px; font-weight: 800; letter-spacing: 0.4px; background: linear-gradient(90deg, #fff, #ffd0e5); -webkit-background-clip: text; background-clip: text; color: transparent; }
      .since .unit { display:block; font-size: 11px; color: #ffd0e5; opacity: .9; letter-spacing: 0.4px; text-transform: uppercase; margin-top: 2px; }
      .timeline { margin-top: 14px; display: grid; gap: 10px; }
      .tl-item { display:flex; gap:10px; align-items:flex-start; }
      .tl-dot { flex:0 0 10px; height:10px; width:10px; border-radius:999px; background: var(--brand); margin-top:6px; box-shadow: 0 0 0 4px rgba(236,72,153,0.12); }
      .tl-body { font-size:14px; color:#e5e7eb; }
      .tl-date { font-size:12px; color:#f9a8d4; }
      .gallery { margin-top: 14px; display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:8px; }
      .ph { position: relative; aspect-ratio: 1 / 1; border-radius: 12px; overflow: hidden; background: #0b0b0b; border:1px solid rgba(244,114,182,0.18); box-shadow: 0 12px 30px -16px rgba(244,114,182,0.25); }
      .ph img { width: 100%; height: 100%; object-fit: cover; display:block; }
      .ph figcaption { position:absolute; left:0; right:0; bottom:0; font-size: 11px; color:#ffe4f1; background: linear-gradient(180deg, rgba(0,0,0,0), rgba(236,72,153,.45)); padding: 10px 8px 6px; }
      /* Floating hearts background */
      .hearts { position: fixed; inset: 0; z-index: 0; pointer-events: none; overflow:hidden; }
      .heart-float {
        position: absolute; width: 18px; height: 16px; background: radial-gradient(circle at 30% 30%, #ffd1e6, #f472b6 70%);
        clip-path: path('M8.9 1.4C10.1 0 12 0 13.2 1.3c1.1-1.3 3.1-1.3 4.2.1 1.3 1.4 1.1 3.5-.3 4.8L13.2 10l-3.9-3.9c-1.4-1.3-1.6-3.4-.4-4.7z');
        animation: floatUp linear infinite, sway ease-in-out infinite;
        opacity: 0.8;
      }
      @keyframes floatUp {
        0% { transform: translate3d(calc(var(--x)*1px), 110vh, 0) scale(var(--s)); opacity:0; }
        10% { opacity: 0.9; }
        100% { transform: translate3d(calc(var(--x)*1px + 20px), -20vh, 0) scale(var(--s)); opacity:0; }
      }
      @keyframes sway {
        0%,100% { margin-left: -6px; }
        50% { margin-left: 10px; }
      }
      .wrap, .card { position: relative; z-index: 1; }
    </style>
  </head>
  <body>
    <div id="hearts" class="hearts" aria-hidden="true"></div>
    <div class="wrap">
      <div class="card">
        <h1>Nordlys <span class="heart">❤</span></h1>
        <div id="unauth">
          <p>Indtast adgangskode for at fortsætte.</p>
          <form id="login">
            <div class="field">
              <input id="pw" type="password" placeholder="Adgangskode" autocomplete="current-password" />
            </div>
            <button id="btn" type="submit">Lås op</button>
            <div id="err" class="error" role="alert" style="display:none;"></div>
          </form>
        </div>
        <div id="auth" style="display:none;">
          <div class="hero">
            <h2 id="hero-heading"></h2>
            <p id="hero-body"></p>
          </div>
          <div id="since" class="since"></div>
          <div id="timeline" class="timeline"></div>
          <div id="gallery" class="gallery"></div>
          <div class="actions">
            <button id="logout" style="width:auto;padding:8px 12px;margin-top:16px;background:#27272a;border:1px solid #3f3f46;">Log ud</button>
          </div>
        </div>
      </div>
      <p style="margin-top:12px;"><a class="link" href="/">← Tilbage til forsiden</a></p>
    </div>
    <script>
      async function check() {
        const r = await fetch('/api/nordlys-session')
        return r.ok
      }
      // Countdown since 21 Nov 2023 (local time)
      let sinceTimer = null
      function startSince() {
        if (sinceTimer) return
        const start = new Date(2023, 10, 21, 0, 0, 0) // 10 = November
        const el = document.getElementById('since')
        function pad(n){ return n.toString().padStart(2,'0') }
        function tick() {
          const now = new Date()
          let diff = Math.max(0, now - start)
          const days = Math.floor(diff / (1000*60*60*24)); diff -= days*(1000*60*60*24)
          const hours = Math.floor(diff / (1000*60*60)); diff -= hours*(1000*60*60)
          const mins = Math.floor(diff / (1000*60)); diff -= mins*(1000*60)
          const secs = Math.floor(diff / 1000)
          el.innerHTML = `
            <div class="row" aria-live="polite">
              <span class="num">${days}</span><span class="unit">dage</span>
              <span class="sep">•</span>
              <span class="num">${pad(hours)}</span><span class="unit">timer</span>
              <span class="sep">:</span>
              <span class="num">${pad(mins)}</span><span class="unit">min</span>
              <span class="sep">:</span>
              <span class="num">${pad(secs)}</span><span class="unit">sek</span>
            </div>`
        }
        tick()
        sinceTimer = setInterval(tick, 1000)
      }
      // Floating heart drift (CSS-based, no 3D)
      let heartsStarted = false
      function startHearts() {
        if (heartsStarted) return; heartsStarted = true
        const container = document.getElementById('hearts')
        const count = 18
        for (let i = 0; i < count; i++) {
          const span = document.createElement('span')
          span.className = 'heart-float'
          span.style.setProperty('--x', (Math.random()*100).toFixed(2))
          span.style.setProperty('--s', (0.6 + Math.random()*0.8).toFixed(2))
          const duration = 14 + Math.random()*10
          const delay = -Math.random()*duration
          span.style.animationDuration = `${duration}s, ${3 + Math.random()*2}s`
          span.style.animationDelay = `${delay}s, ${delay}s`
          container.appendChild(span)
        }
      }
      async function loadContent() {
        const r = await fetch('/api/nordlys-content')
        if (!r.ok) throw new Error('Unauthorized')
        const j = await r.json()
        const d = j?.data || {}
        document.title = d.title || 'Nordlys'
        document.getElementById('hero-heading').textContent = d.hero?.heading || ''
        document.getElementById('hero-body').textContent = d.hero?.body || ''
        startSince()
        startHearts()
        // timeline
        const tl = document.getElementById('timeline'); tl.innerHTML = ''
        ;(d.timeline || []).forEach(item => {
          const div = document.createElement('div'); div.className = 'tl-item'
          div.innerHTML = '<span class=\"tl-dot\"></span><div class=\"tl-body\"><div class=\"tl-date\"></div><div class=\"tl-text\"></div></div>'
          div.querySelector('.tl-date').textContent = item.date || ''
          div.querySelector('.tl-text').textContent = item.text || ''
          tl.appendChild(div)
        })
        // gallery
        const g = document.getElementById('gallery'); g.innerHTML = ''
        ;(d.gallery || []).forEach(item => {
          const fig = document.createElement('figure'); fig.className = 'ph'
          const img = document.createElement('img')
          img.alt = item.caption || 'Photo'
          img.loading = 'lazy'
          img.decoding = 'async'
          img.src = '/api/nordlys-photo?id=' + encodeURIComponent(item.id)
          img.onerror = () => { fig.style.display = 'none' } // hide if missing
          const cap = document.createElement('figcaption'); cap.textContent = item.caption || ''
          fig.appendChild(img); fig.appendChild(cap); g.appendChild(fig)
        })
      }
      async function show(state) {
        document.getElementById('unauth').style.display = state === 'unauth' ? '' : 'none'
        document.getElementById('auth').style.display = state === 'auth' ? '' : 'none'
      }
      document.getElementById('login').addEventListener('submit', async (e) => {
        e.preventDefault()
        const pw = document.getElementById('pw').value
        const btn = document.getElementById('btn')
        const err = document.getElementById('err')
        err.style.display='none'; err.textContent = ''
        btn.disabled = true
        try {
          const r = await fetch('/api/nordlys-login', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ password: pw, redirect: '/nordlys' }) })
          const j = await r.json().catch(()=>({}))
          if (!r.ok || !j.ok) throw new Error(j.error || 'Ugyldig adgangskode')
          await show('auth'); await loadContent()
        } catch (ex) {
          err.textContent = ex.message || 'Noget gik galt'; err.style.display='block'
        } finally {
          btn.disabled = false
        }
      })
      document.getElementById('logout').addEventListener('click', async () => {
        await fetch('/api/nordlys-logout',{ method:'POST' })
        await show('unauth')
      })
      ;(async () => { if (await check()) { await show('auth'); await loadContent() } })()
    </script>
  </body>
</html>


